<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Draevorn - Factions Lumi√®re & T√©n√®bres</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet" />

  <script>
    (function(){
      const s = sessionStorage.getItem('draevorn_logged');
      if (!s) return window.location.replace('login.html');
      const data = JSON.parse(s);
      const maxAge = 24*60*60*1000;
      if (!data.user || Date.now() - (data.ts||0) > maxAge){
        sessionStorage.removeItem('draevorn_logged');
        return window.location.replace('login.html');
      }
    })();
  </script>

  <style>
    :root{
      --gold:#ffd700;--bg1:#000;--bg2:#001b33;--glow:#fff;--blueglow:#4db8ff;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Orbitron',sans-serif;color:#fff;min-height:100vh;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));overflow-x:hidden;
      position:relative;
    }
    body::before,body::after{
      content:"";position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;
      background:radial-gradient(circle at 30% 20%,rgba(77,184,255,.08),transparent 60%),
      radial-gradient(circle at 70% 80%,rgba(255,255,255,.06),transparent 70%);
      animation:lights 8s ease-in-out infinite alternate;
    }
    @keyframes lights{0%{opacity:.7}100%{opacity:1;transform:scale(1.1)}}

    /* HAMBURGER */
    .hamburger-menu{position:fixed;top:18px;left:18px;z-index:2400;display:flex;gap:12px}
    .hamburger{
      width:42px;height:30px;padding:6px;display:flex;flex-direction:column;
      gap:6px;border-radius:8px;cursor:pointer;
      background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);
      box-shadow:0 6px 18px rgba(0,0,0,.45);transition:.18s;
    }
    .hamburger div{height:3px;width:100%;background:var(--gold);border-radius:3px;transition:.22s}
    .hamburger.active div:nth-child(1){transform:rotate(45deg) translate(5px,5px)}
    .hamburger.active div:nth-child(2){opacity:0;transform:translateX(-6px)}
    .hamburger.active div:nth-child(3){transform:rotate(-45deg) translate(5px,-5px)}

    /* Santa danse */
    .santa-dance{font-size:26px;animation:santaDance 1.2s infinite alternate ease-in-out}
    @keyframes santaDance{from{transform:rotate(-15deg)}to{transform:rotate(15deg) scale(1.2)}}

    .side-menu{
      position:fixed;top:0;left:-260px;width:240px;height:100vh;z-index:2300;
      background:rgba(0,0,0,.9);backdrop-filter:blur(10px);
      padding-top:72px;display:flex;flex-direction:column;gap:10px;
      transition:left .28s;box-shadow:6px 0 40px rgba(0,0,0,.6);
    }
    .side-menu.open{left:0}
    .side-menu a{
      color:#fff;text-decoration:none;font-size:15px;padding:12px 20px;margin:0 12px;
      border-radius:10px;display:flex;gap:10px;transition:.18s;
    }
    .side-menu a:hover{background:rgba(255,255,255,.06);transform:translateX(6px) scale(1.01)}
    .logout-btn:hover{background:rgba(255,80,80,.08);color:#ffdcdc}

    header{text-align:center;padding:120px 20px 40px;position:relative;z-index:2}
    header h1{
      font-size:64px;color:var(--glow);text-shadow:0 0 15px rgba(255,255,255,.8),
      0 0 30px rgba(77,184,255,.4),0 0 60px rgba(77,184,255,.3);
      animation:glowPulse 4s infinite;
    }
    @keyframes glowPulse{50%{text-shadow:0 0 25px #fff,0 0 50px var(--blueglow),0 0 90px var(--blueglow)}}
    header p{color:#bfefff;margin-top:10px;font-size:16px}

    /* News */
    .news-section{text-align:center;padding:60px 20px 80px;position:relative;z-index:2}
    .news-section h2{font-size:28px;margin-bottom:24px;text-shadow:0 0 15px rgba(255,255,255,.4)}
    .news-cards{display:flex;justify-content:center;flex-wrap:wrap;gap:20px}
    .news-card{
      background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.07);
      border-radius:18px;width:260px;padding:20px;transition:.25s;
      box-shadow:0 0 20px rgba(77,184,255,.1);
    }
    .news-card:hover{transform:scale(1.05);box-shadow:0 0 25px rgba(77,184,255,.4)}
    .news-card h3{font-size:18px;margin-bottom:8px}
    .news-card p{font-size:14px;color:#bfefff}

    #link-wow{
      margin-top:30px;padding:10px 20px;border-radius:20px;font-size:15px;cursor:pointer;
      background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);
      transition:.3s;
    }
    #link-wow:hover{background:rgba(77,184,255,.2);transform:scale(1.05)}
  </style>
</head>
<body>

  <div class="hamburger-menu">
    <div class="hamburger" id="hamburger"><div></div><div></div><div></div></div>
    <div class="santa-dance">üéÖ</div>

    <nav class="side-menu" id="side-menu">
      <a href="staff.html">üëë Membre Staff</a>
      <a href="cinema.html">üé¨ Planning Cin√©ma</a>
      <a href="bloxfruits.html">üçç Blox Fruits</a>
      <a href="boutique.html">üõí Boutique</a>
      <a href="profil.html">üßë Profil</a>
      <a href="pipi.html">üè† Accueil</a>

      <hr>
      <a href="#" class="logout-btn" onclick="logout()">üö™ D√©connexion</a>
    </nav>
  </div>

  <header>
    <h1>‚ú® Draevorn</h1>
    <p>Factions Lumi√®re & T√©n√®bres - PvP | Magie | Qu√™tes | Conqu√™te</p>

    <button id="link-wow">üîó Lier mon compte WoW</button>
    <div id="wow-result" style="margin-top:10px;color:#fff"></div>
  </header>

  <section class="news-section">
    <h2>üì∞ Actualit√©s</h2>
    <div class="news-cards">
      <div class="news-card"><h3>üõ†Ô∏è Serveur Minecraft</h3><p>Actuellement en maintenance.</p></div>
      <div class="news-card"><h3>‚öîÔ∏è Serveur World of Warcraft</h3><p>En cours de pr√©paration.</p></div>
      <div class="news-card"><h3>üåê Site Draevorn</h3><p>Mise √† jour majeure en cours.</p></div>
    </div>
  </section>

  <script>
    const h=document.getElementById('hamburger');const m=document.getElementById('side-menu');
    h.onclick=e=>{e.stopPropagation();h.classList.toggle('active');m.classList.toggle('open')};
    m.onmouseleave=()=>{h.classList.remove('active');m.classList.remove('open')};
    document.onclick=e=>{if(!m.contains(e.target)&&!h.contains(e.target)){h.classList.remove('active');m.classList.remove('open')}}
    function logout(){sessionStorage.removeItem('draevorn_logged');window.location.replace('login.html')}
  </script>

  <script>
    document.getElementById('link-wow').addEventListener('click', async () => {
      const pseudo = prompt("Entre ton pseudo WoW :");
      if (!pseudo) return;
      document.getElementById('wow-result').textContent = "Connexion √† Draevorn WoW...";

      const res = await fetch('http://79.90.44.4/linkwow.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pseudo })
      });

      const data = await res.json();
      if (data.success) {
        document.getElementById('wow-result').textContent = "‚úÖ Compte WoW li√© avec succ√®s !";
      } else {
        document.getElementById('wow-result').textContent = "‚ùå Erreur : " + data.error;
      }
    });
    async function generateTokenForWebUser(webUser) {
  const res = await fetch('http://79.90.44.4/generate_token.php', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ webUser })
  });
  return await res.json();
}

async function checkTokenStatus(token) {
  const res = await fetch('http://79.90.44.4/status_token.php?token=' + encodeURIComponent(token));
  return await res.json();
}

// exemple d'utilisation depuis bouton
document.getElementById('link-wow').addEventListener('click', async () => {
  const webUser = JSON.parse(sessionStorage.getItem('draevorn_logged')).user;
  const r = await generateTokenForWebUser(webUser);
  if (!r.success) return alert('Erreur g√©n√©ration token');

  const token = r.token;
  alert("Token g√©n√©r√© : " + token + "\nEntrez en jeu : /link " + token);

  // polling
  const maxTries = 40; // ~2 minutes si interval 3s
  let tries = 0;
  const interval = setInterval(async () => {
    tries++;
    const s = await checkTokenStatus(token);
    if (s.success && s.linked) {
      clearInterval(interval);
      alert("Compte li√© avec " + s.game_account);
    } else if (tries >= maxTries) {
      clearInterval(interval);
      alert("Temps √©coul√©, g√©n√®re un nouveau token.");
    }
  }, 3000);
});

  </script>

  <script>
    const santaContainer = document.createElement('div');
    santaContainer.style.position='fixed';
    santaContainer.style.top='0';
    santaContainer.style.left='0';
    santaContainer.style.width='100%';
    santaContainer.style.height='100%';
    santaContainer.style.pointerEvents='none';
    santaContainer.style.overflow='hidden';
    santaContainer.style.zIndex='-1';
    document.body.appendChild(santaContainer);

    function createSanta(){
      const santa=document.createElement('div');
      santa.textContent='üéÖ';
      santa.style.position='absolute';
      santa.style.left=Math.random()*100+'vw';
      santa.style.top='-40px';
      santa.style.fontSize=(Math.random()*18+18)+'px';
      santa.style.opacity=Math.random()*0.8+0.2;
      santaContainer.appendChild(santa);

      const fallDuration=Math.random()*6+6;
      const drift=(Math.random()-0.5)*100;

      santa.animate([
        { transform:`translate(0,0) rotate(0deg)` },
        { transform:`translate(${drift}px,100vh) rotate(${Math.random()*360}deg)` }
      ],{ duration:fallDuration*1000, easing:'linear' });

      setTimeout(()=>santa.remove(), fallDuration*1000);
    }
    setInterval(createSanta,800);
  </script>
</body>
</html>
